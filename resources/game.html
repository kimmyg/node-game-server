<!DOCTYPE html>
<html>

<head>
<link rel="stylesheet" href="style.css" type="text/css"/>
<meta name="viewport" content="width=device-width,user-scalable=no"/>
<script type="text/javascript">
function $( id ) {
	return document.getElementById( id );
}

window.onload = function( event ) {
	var ws = new WebSocket( 'ws://' + location.host + location.pathname );

	//ws.onopen = function( event ) {}

	ws.onmessage = function( event ) {
		var message = JSON.parse( event.data );

		if( message.type === 'add_game' ) {
			var li = document.createElement( 'li' );

			li.id = message.id;

			var a = document.createElement( 'a' );

			a.href = location.pathname + '/' + message.id;
			a.innerText = message.name;

			li.appendChild( a );

			$('games').appendChild( li );
		}
		else if( message.type === 'add_gathering' ) {
			var li = document.createElement( 'li' );

			li.id = message.id;

			var a = document.createElement( 'a' );

			a.href = location.pathname + '/' + message.id;
			a.innerText = message.name;

			li.appendChild( a );

			$('gatherings').appendChild( li );
		}
		else if( message.type === 'remove' ) {
			var element = $( message.id );
			
			console.log( message.id );
			console.log( element );
			
			element.parentElement.removeChild( element );
		}
		else if( message.type === 'rename' ) {
			$( message.id ).children[0].innerText = message.name;
		}
		else {
			console.log( 'unrecognized message type: ' + message.type );
		}
	};

	//ws.onclose = function( event ) {}
	//ws.onerror = function( event ) {}
}
</script>
</head>

<body>
	<div class="header">
		<span class="title">games in progress</span>
		<ul id="games"></ul>
	</div>
	<div class="header">
		<span class="title">gatherings</span>
		<ul id="gatherings"></ul>
	</div>
	
	<a class="button" href="/ghost/new">create game</a>
</body>

</html>
