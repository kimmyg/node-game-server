<!DOCTYPE html>
<html>

<head>
<meta name="viewport" content="width=device-width"/>
<style type="text/css">
body {
	margin: 0;
	padding: 0;
}

body {
	background: #aaa;
	font-family: sans-serif;
	text-align: center;
	text-color: white;
	color: #353535;
}

#players_container {
	width: 100%;
	height: 32px;

	margin: 0;
	padding: 0;

	border-spacing: 4px;
}

#players_container td {
	border-radius: 6px;
	padding: 4px 8px;
	border: solid #777 1px;
}

#bubble {
	background-color: white;
	border: solid #777 1px;
	color: #333;
	font-size: 2em;
	text-align: center;
	padding: 0;
	margin: 0 4px;
	border-radius: 8px;
}

#letters {
	margin-top: 6px;
}

.button {
	display: inline-block;
	vertical-align: baseline;
	margin: 0.25em 0.125em;
	cursor: pointer;
	text-align: center;
	text-decoration: none;
	padding: 0.2em 0.4em;
	text-shadow: 0 1px 1px rgba(0,0,0,0.3);
	-webkit-border-radius: 0.5em;
	-webkit-box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.white {
	color: #606060;
	border: solid 1px #b7b7b7;
	background: -webkit-gradient(linear, left top, left bottom, from(#fff), to(#ededed));
}

.gray {
	color: #e9e9e9;
	border: solid 1px #555;
	background: -webkit-gradient(linear, left top, left bottom, from(#888), to(#575757));
}

.red {
	color: #faddde;
	border: solid 1px #980c10;
	background: -webkit-gradient(linear, left top, left bottom, from(#ed1c24), to(#aa1317));
}

.orange {
	color: #fef4e9;
	border: solid 1px #da7c0c;
	background: -webkit-gradient(linear, left top, left bottom, from(#faa51a), to(#f47a20));
}

.green {
	color: #e8f0de;
	border: solid 1px #538312;
	background: -webkit-gradient(linear, left top, left bottom, from(#7db72f), to(#4e7d0e));
}

.hidden {
	display: none;
}

.player_0 {
	background: #aab;
}

.player_1 {
	background: #aba;
}

.player_2 {
	background: #baa;
}

.player_3 {
	background: #bba;
}

.player_4 {
	background: #bab;
}

.player_5 {
	background: #abb;
}
</style>
<script type="text/javascript">
function $( id ) {
	return document.getElementById( id );
}

window.onload = function( event ) {
	$('interface').classList.add( 'hidden' );

	var players = null;

	var word = null;

	var state = null;
	var state_data = null;

	var ws = new WebSocket( 'ws://' + location.host + location.pathname );

	//ws.onopen = function( event ) {}

	ws.onmessage = function( event ) {
		var message = JSON.parse( event.data );

		// just connected, init
		if( message.type === 'init' ) {
			console.log( 'init' );

			players = message.players;

			for( var i = 0; i < players.length; ++i ) {
				var td = document.createElement( 'td' );

				td.classList.add( 'player_' + i );
				td.classList.add( 'absent' )
				td.id = players[i];
				td.innerText = players[i];

				$('players').appendChild( td );
			}

			for( var i = 0; i < message.present; ++i ) {
				$( message.present[i] ).classList.remove( 'absent' );
			}

			// if we're in the game (specified by state), show the interface
			// and change it according to the actual state
		}
		// no longer waiting for player X
		else if( message.type === 'join' ) {
			console.log( 'join ' + message.player );
			$( message.player ).classList.remove( 'absent' );
		}
		else if( message.type === 'left' ) {
			console.log( 'left ' + message.player );
			$( message.player ).classList.add( 'absent' );
		}
		// game starts
		else if( message.type === 'start' ) {
			console.log( 'start' );

			state = 1;
			state_data = null;

			$('interface').classList.remove( 'hidden' );
		}
		// round starts
		else if( message.type === 'round_start' ) {
			word = [];

			state = 0;
			state_data = null;
			
		}

		// turn of player X
		else if( message.type === 'turn' ) {
			// set background to message.turn_index
			$('status').innerText = 'it\'s ' + message.turn + '\'s turn';
		}
		// your turn
		else if( message.type === 'your_turn' ) {
			// set background to message.turn_index
			$('status').innerText = 'it\'s your turn';
		}
		// add letter
		else if( message.type === 'letter' ) {
			word.push( message.letter );

			$('word').innerText = word.join( '' );
		}
		// X challenged Y (challenge phase)
		else if( message.type === 'challenge' ) {
			state = 3;
			state_data = {
				challenger:1
			};
		}
		// challenge letter added
		// challenge letter removed
		// challenge word declared (voting phase)
		// waiting for players X_1, ... to vote
		// no longer waiting for player X to vote
		// voted that A, X is out
		// X declared word (voting phase)
		// waiting...
		// no longer waiting for...
		// voted that A, X is out
		// X proposes to kick Y out of game (must it be Y's turn?)
		// waiting for votes
		// no longer waiting for X
		// figure out voting timeout strategy


		else if( message.type === 'status' ) {
			$('status').innerText = message.message;
		}
		else if( message.type === 'turn' ) {
			$('status').innerText = 'It\'s your turn.';
		}


		else if( message.type === 'players' ) {
			for( var i = 0; i < message.players.length; ++i ) {
				var li = document.createElement( 'li' );
			
				li.id = message.players[i];
				li.innerText = message.players[i];
		
				$('players').appendChild( li );
			}
		}
		else if( message.type === 'add' ) {
			var li = document.createElement( 'li' );
				
			li.id = message.name;
			li.innerText = message.name;
			
			$('players').appendChild( li );
		}
		else if( message.type === 'remove' ) {
			$('players').removeChild( $( message.name ) );
		}
		else {
			console.log( 'unrecognized message type ' + message.type );
		}

	};

	//ws.onclose = function( event ) {}
	//ws.onerror = function( event ) {}
}
</script>
</head>

<body>
	<table id="players_container"><tr id="players"></td></table>
	<div id="status"></div>
	<div id="interface">
		<div id="bubble">
			<span id="word">&nbsp;</span>
		</div>
		<div id="letters">
			<a class="gray button" onclick="add_letter(this);">Q</a>
			<a class="gray button" onclick="add_letter(this);">W</a>
			<a class="gray button" onclick="add_letter(this);">E</a>
			<a class="gray button" onclick="add_letter(this);">R</a>
			<a class="gray button" onclick="add_letter(this);">T</a>
			<a class="gray button" onclick="add_letter(this);">Y</a>
			<a class="gray button" onclick="add_letter(this);">U</a>
			<a class="gray button" onclick="add_letter(this);">I</a>
			<a class="gray button" onclick="add_letter(this);">O</a>
			<a class="gray button" onclick="add_letter(this);">A</a>
			<a class="gray button" onclick="add_letter(this);">S</a>
			<a class="gray button" onclick="add_letter(this);">D</a>
			<a class="gray button" onclick="add_letter(this);">F</a>
			<a class="gray button" onclick="add_letter(this);">G</a>
			<a class="gray button" onclick="add_letter(this);">H</a>
			<a class="gray button" onclick="add_letter(this);">J</a>
			<a class="gray button" onclick="add_letter(this);">K</a>
			<a class="gray button" onclick="add_letter(this);">L</a>
			<a class="gray button" onclick="add_letter(this);">Z</a>
			<a class="gray button" onclick="add_letter(this);">X</a>
			<a class="gray button" onclick="add_letter(this);">C</a>
			<a class="gray button" onclick="add_letter(this);">V</a>
			<a class="gray button" onclick="add_letter(this);">B</a>
			<a class="gray button" onclick="add_letter(this);">N</a>
			<a class="gray button" onclick="add_letter(this);">M</a>
			<a class="gray button" onclick="add_letter(this);">P</a>
		</div>
		<div id="signal">
			<span id="declare_button">
				<a class="gray button" onclick="declare();">DECLARE</a>
			</span>
			<span id="challenge_button">
				<a class="gray button" onclick="challenge();">CHALLENGE</a>
			</span>
		</div>
		<div id="confirm_declare">
			<span id="declare_name"></span> declares <span id="declare_word"></span> a word.
			<a class="gray button" onclick="declare_affirm();"><span id="declare_affirm_word"></span> is a word</a>
			<a class="gray button" onclick="declare_negate();"><span id="declare_negate_word"></span> is <em>not</em> a word</a>
		</div>
		<!--<div id="confirm_challenge">
			<span id="challenge_name"></span> challenges <span id="challenge_word"></span>.
			<a class="gray button" onclick="challenge_affirm();"><span id="challenge_negate_word"></span> does start a word</a>
			<a class="gray button" onclick="challenge_negate();"><span id="challenge_negate_word"></span> does <em>not</em> start a word</a>
			
		</div>-->
	</div>
	
</body>

</html>

<!--<body>
	<span id="word"></span>
	<div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
		<div>a</div>
	</div>
	<div>
		<div>challenge</div>
		<div>declare</div>
	</div>
	<div>
		<div>Is this a word?</div>
		<div>Yes</div>
		<div>No</div>
	</div>
	<div>It's your turn./It's kimmyg's turn.</div>
		<div>Waiting on you and two others./Waiting on you./Waiting on two others.</div>
	<div id="status"></div>
</body>

</html>-->
